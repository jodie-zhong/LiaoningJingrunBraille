define(function(require, exports, module) {
	"use strict";

	var ItemBase = require('../item-base');
	var util = require('../../../../../common/util.js');

	/**
	 * Workflow Item
	 */
	var Item = ItemBase.extend({
		// 保存/提交接口
		saveAction: 'printing/modifyPrinting.action',
		// 查询接口
		detailAction: 'printing/searchPrintingDetail.action',

		onHandleChange: function() {
			var printNum = this.$('input[name="printNum"]').val();
			this.$('div[data-area="nextFlow"]').hide();
			if(printNum <= 50) {
				// 刻印
				this.$('input[name="handleState"]').val('1');
				this.$('div[data-flow="engraving"]').show();
				this.$('div[data-flow="braillePrintDeptDesignLeaderIssued "]').show();
			} else {
				// 制版
				this.$('input[name="handleState"]').val('2');
				this.$('div[data-flow="plate"]').show();
				this.$('div[data-flow="publicationDeptDesignHeadIssued "]').show();

			}
		},

		/**
		 * 保存或提交工作流
		 * @param isSubmit
		 */
		getFormData: function() {
			var $form = this.$('#formEdit');
			// 先调用父类生成基本的数据结构
			var params = this._super();
			// 处理上传部份数据结构
			params.listNext = [];
			var $flow;
			$form.find('div[data-area="nextFlow"]').each(function() {
				$flow = $(this);
				if($(this).is(':hidden')) {
					return;
				} else {
					params.listNext.push({
						flowId: $flow.find('input[name="flowId"]').val(),
						flowName: $flow.find('input[name="flowName"]').val(),
						nextCategory: $flow.find('input[name="nextCategory"]').val(),
						deptIds: $flow.find('input[name="deptIds"]').val(),
						roleIds: $flow.find('input[name="roleIds"]').val(),
						taskId: $flow.find('input[name="taskId"]').val(),
						taskUsers: $flow.find('input[name="taskUsers"]').val()
					});
				}
			});
			return params;
		},

		/**
		 * 初始化页面事件
		 */
		initPageEvent: function() {
			var that = this;
			// 审核结果
			this.$container.on('change', 'input[name="printNum"]', this.onHandleChange.bind(this));
		},

		/**
		 * 初始化页面数据
		 */
		initPageData: function() {
			// 初始化日期组件
			this.$('input.date-time').datetimepicker({
				format: 'YYYY-MM-DD',
				locale: 'zh-cn',
				sideBySide: true
			});
			this.onHandleChange();
		},

		/**
		 * 构造函数
		 * @param container
		 * @param tpl
		 */
		init: function(container, tpl) {
			this._super(container, tpl);
		},

		/**
		 * 渲染页面
		 */
		render: function() {
			this._super();

			this.initPageEvent();

			this.initPageData();
		}

	});

	module.exports = Item;

});